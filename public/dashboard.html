<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Account Planner - Demo Dashboard</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <div class="logo-section">
                    <i class="fas fa-brain"></i>
                    <h1>AI Account Planner</h1>
                    <span class="version">v1.0.0</span>
                </div>
                <div class="system-status" id="systemStatus">
                    <div class="status-indicator" id="statusIndicator">
                        <i class="fas fa-circle"></i>
                        <span id="statusText">Checking...</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Navigation Tabs -->
            <nav class="dashboard-tabs">
                <button class="tab-button active" data-tab="demo">Demo</button>
                <button class="tab-button" data-tab="workflows">Workflows</button>
                <button class="tab-button" data-tab="integration">Integration</button>
                <button class="tab-button" data-tab="settings">Settings</button>
            </nav>

            <!-- Demo Tab -->
            <div class="tab-content active" id="demo-tab">
                <div class="section">
                    <div class="section-header">
                        <h2><i class="fas fa-rocket"></i> Account Plan Demo</h2>
                        <p>Generate AI-powered account plans for demonstration</p>
                    </div>
                    
                    <div class="demo-controls">
                        <div class="input-group">
                            <label for="accountName">Account Name:</label>
                            <select id="accountName">
                                <option value="Stripe">Stripe</option>
                                <option value="TechCorp">TechCorp</option>
                                <option value="RetailPlus">RetailPlus</option>
                                <option value="FinanceFlow">FinanceFlow</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="emailRecipients">Email Recipients:</label>
                            <input type="email" id="emailRecipients" value="demo@example.com" placeholder="demo@example.com">
                        </div>
                        <button id="generatePlanBtn" class="primary-button">
                            <i class="fas fa-magic"></i> Generate Account Plan
                        </button>
                    </div>

                    <div class="demo-results" id="demoResults">
                        <!-- Results will appear here -->
                    </div>
                </div>
            </div>

            

            <!-- Settings Tab -->
            <div class="tab-content" id="settings-tab">
                <div class="section">
                    <div class="section-header">
                        <h2><i class="fas fa-sliders-h"></i> Settings</h2>
                        <p>Configure AI prompts, data source, MCPs and logging</p>
                    </div>

                    <div class="system-grid">
                        <div class="system-card">
                            <div class="card-header">
                                <h3><i class="fas fa-robot"></i> AI Instructions</h3>
                                <div class="header-actions">
                                    <button class="refresh-btn" data-action="load-settings"><i class="fas fa-sync-alt"></i></button>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="form-group">
                                    <label for="aiProvider">Provider</label>
                                    <select id="aiProvider">
                                        <option value="mixed">Mixed</option>
                                        <option value="openai">OpenAI</option>
                                        <option value="anthropic">Anthropic</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="aiTemperature">Temperature</label>
                                    <input type="number" step="0.1" min="0" max="1" id="aiTemperature" />
                                </div>
                                <div class="form-group">
                                    <label for="aiSystemPrompt">System Prompt</label>
                                    <textarea id="aiSystemPrompt" placeholder="Customize the assistant instruction"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="aiToolSystemPrompt">Tool System Prompt</label>
                                    <textarea id="aiToolSystemPrompt" placeholder="Customize the tool-enabled instruction"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="system-card">
                            <div class="card-header">
                                <h3><i class="fas fa-database"></i> Data & MCP</h3>
                            </div>
                            <div class="card-content">
                                <div class="form-group">
                                    <label for="dataSource">Data Source</label>
                                    <select id="dataSource">
                                        <option value="sample">Sample (no keys)</option>
                                        <option value="mcp">MCP (Klavis)</option>
                                        <option value="external">External (News/API)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>MCP Servers</label>
                                    <div>
                                        <label><input type="checkbox" id="mcpGmail" /> Gmail</label>
                                    </div>
                                    <div>
                                        <label><input type="checkbox" id="mcpCalendar" /> Google Calendar</label>
                                    </div>
                                    <div>
                                        <label><input type="checkbox" id="mcpDrive" /> Google Drive</label>
                                    </div>
                                    <div>
                                        <label><input type="checkbox" id="mcpSlack" /> Slack</label>
                                    </div>
                                    <div>
                                        <label><input type="checkbox" id="mcpNotion" /> Notion</label>
                                    </div>
                                    <small>Changes to data source/MCPs may require reload.</small>
                                </div>
                            </div>
                        </div>

                        <div class="system-card">
                            <div class="card-header">
                                <h3><i class="fas fa-bug"></i> Error Handling</h3>
                            </div>
                            <div class="card-content">
                                <div class="form-group">
                                    <label for="logLevel">Log Level</label>
                                    <select id="logLevel">
                                        <option value="error">error</option>
                                        <option value="warn">warn</option>
                                        <option value="info">info</option>
                                        <option value="debug">debug</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <small>Advanced error handling settings can be configured via environment variables for now.</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions" style="margin-top: 1rem;">
                        <button class="secondary-button" id="saveSettingsBtn"><i class="fas fa-save"></i> Save</button>
                        <button class="primary-button" id="applySettingsBtn"><i class="fas fa-refresh"></i> Apply & Reload</button>
                    </div>
                </div>
            </div>

            <!-- Workflows Tab -->
            <div class="tab-content" id="workflows-tab">
                <div class="section">
                    <div class="section-header">
                        <h2><i class="fas fa-sitemap"></i> Workflow Management</h2>
                        <button id="createWorkflowBtn" class="primary-button">
                            <i class="fas fa-plus"></i> Create Workflow
                        </button>
                    </div>
                    
                    <div class="workflows-list" id="workflowsList">
                        <div class="loading">Loading workflows...</div>
                    </div>
                </div>

                <!-- Job Queue Management (moved from Queues tab) -->
                <div class="section">
                    <div class="section-header">
                        <h2><i class="fas fa-tasks"></i> Job Queue Management</h2>
                        <div class="header-actions">
                            <button class="secondary-button" onclick="window.open('/admin/queues', '_blank')">
                                <i class="fas fa-external-link-alt"></i> Bull Board Dashboard
                            </button>
                            <button class="refresh-btn" data-endpoint="/queue/stats">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="queue-stats" id="queueStats">
                        <div class="loading">Loading queue statistics...</div>
                    </div>
                </div>

                <!-- Demo Workflow Outline & Creator -->
                <div class="section">
                    <div class="section-header">
                        <h2><i class="fas fa-lightbulb"></i> Demo Workflow: Account Plan Orchestration</h2>
                        <p>Collect, analyze, and distribute account plans via Email and Slack (#dealflow).</p>
                    </div>
                    <div class="system-grid">
                        <div class="system-card">
                            <div class="card-header"><h3>Goal</h3></div>
                            <div class="card-content">
                                Generate comprehensive account plans by collecting data from multiple sources, analyzing account health, and distributing actionable insights to stakeholders via email, Slack, and Airtable.
                            </div>
                        </div>
                        <div class="system-card">
                            <div class="card-header"><h3>Integrations</h3></div>
                            <div class="card-content">
                                <ul>
                                    <li>Pull account data, contacts, deals, and health scores</li>
                                    <li>Retrieve recent emails and send account plan summaries</li>
                                    <li>Send notifications and updates to relevant channels (CSV-provided content)</li>
                                </ul>
                            </div>
                        </div>
                        <div class="system-card">
                            <div class="card-header"><h3>Instructions</h3></div>
                            <div class="card-content">
                                <strong>Data Collection Phase</strong>
                                <ul>
                                    <li>Pull Airtable People.ai demo table (contacts, deals, health)</li>
                                    <li>Mock-scan Gmail (last 30 days) related to the account</li>
                                    <li>Gather call transcripts and meeting notes</li>
                                    <li>Validate minimum data: 3+ emails, 1+ call</li>
                                </ul>
                                <strong>Account Plan Generation</strong>
                                <ul>
                                    <li>Calculate health score and status</li>
                                    <li>Top 3 strategic recommendations with deadlines</li>
                                    <li>Map key stakeholders and influence</li>
                                    <li>Identify expansion opportunities and risks</li>
                                    <li>Define clear next actions</li>
                                </ul>
                                <strong>Distribution Phase</strong>
                                <ul>
                                    <li>Email owner with subject: "Account Plan: [Account Name] - [Date]"</li>
                                    <li>Update Airtable with health score, tasks, and next review (+7d)</li>
                                    <li>Slack post to #dealflow; if health < 70, also #sales-alerts; else #account-planning</li>
                                </ul>
                                <strong>Error Handling</strong>
                                <ul>
                                    <li>Insufficient data: notify owner via Slack</li>
                                    <li>System failures: retry once, then alert admin</li>
                                    <li>Follow up in 48h if no response</li>
                                </ul>
                                <strong>Notes</strong>
                                <ul>
                                    <li>Health emojis: 🟢 (80+), 🟡 (60–79), 🔴 (<60)</li>
                                    <li>Always include deadlines and prioritize expansion</li>
                                    <li>Mock Gmail; Airtable scoped to People.ai demo table</li>
                                </ul>
                            </div>
                        </div>
                        <div class="system-card">
                            <div class="card-header"><h3>Create Demo Workflow</h3></div>
                            <div class="card-content">
                                <div class="form-group">
                                    <label>Workflow Name</label>
                                    <input type="text" id="demoWorkflowName" value="Demo: Account Plan Orchestration">
                                </div>
                                <div class="form-group">
                                    <label>Account</label>
                                    <input type="text" id="demoWorkflowAccount" value="stripe">
                                </div>
                                <div class="form-group">
                                    <label>Schedule (Cron)</label>
                                    <input type="text" id="demoWorkflowSchedule" placeholder="0 9 * * 1">
                                </div>
                                <div class="form-group">
                                    <label>Schedule Type:</label>
                                    <select id="demoScheduleType">
                                        <option value="">Custom (Cron)</option>
                                        <option value="hourly">Hourly</option>
                                        <option value="daily">Daily</option>
                                        <option value="weekly">Weekly</option>
                                    </select>
                                </div>
                                <div class="form-group" id="demoScheduleBuilder" style="display:none;">
                                    <div id="demoBuilderHourly" style="display:none;">
                                        <label>Minute:</label>
                                        <select id="demoScheduleMinute"></select>
                                    </div>
                                    <div id="demoBuilderDaily" style="display:none;">
                                        <label>Time:</label>
                                        <select id="demoScheduleHour"></select> : <select id="demoScheduleMinuteDaily"></select>
                                    </div>
                                    <div id="demoBuilderWeekly" style="display:none;">
                                        <label>Day:</label>
                                        <select id="demoScheduleDOW">
                                            <option value="1">Mon</option>
                                            <option value="2">Tue</option>
                                            <option value="3">Wed</option>
                                            <option value="4">Thu</option>
                                            <option value="5">Fri</option>
                                            <option value="6">Sat</option>
                                            <option value="0">Sun</option>
                                        </select>
                                        <label style="margin-left:8px;">Time:</label>
                                        <select id="demoScheduleHourWeekly"></select> : <select id="demoScheduleMinuteWeekly"></select>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button class="secondary-button" id="createDemoWorkflowBtn"><i class="fas fa-plus"></i> Create</button>
                                    <button class="primary-button" id="createAndRunDemoWorkflowBtn"><i class="fas fa-play"></i> Create & Run</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Create Workflow Modal -->
                
                <div class="modal" id="createWorkflowModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Create New Workflow</h3>
                            <button class="close-modal">&times;</button>
                        </div>
                        <form id="createWorkflowForm">
                            <div class="form-group">
                                <label>Workflow Name:</label>
                                <input type="text" id="workflowName" required>
                            </div>
                            <div class="form-group">
                                <label>Description:</label>
                                <textarea id="workflowDescription"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Schedule Preset:</label>
                                <select id="schedulePreset">
                                    <option value="">Custom</option>
                                    <option value="0 9 * * *">Daily at 09:00</option>
                                    <option value="0 8 * * 1">Weekly Mon 08:00</option>
                                    <option value="0 9 1 */3 *">Quarterly 1st 09:00</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Schedule Type:</label>
                                <select id="scheduleType">
                                    <option value="">Custom (Cron)</option>
                                    <option value="hourly">Hourly</option>
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                </select>
                            </div>
                            <div class="form-group" id="scheduleBuilder" style="display:none;">
                                <div id="builderHourly" style="display:none;">
                                    <label>Minute:</label>
                                    <select id="scheduleMinute"></select>
                                </div>
                                <div id="builderDaily" style="display:none;">
                                    <label>Time:</label>
                                    <select id="scheduleHour"></select> : <select id="scheduleMinuteDaily"></select>
                                </div>
                                <div id="builderWeekly" style="display:none;">
                                    <label>Day:</label>
                                    <select id="scheduleDOW">
                                        <option value="1">Mon</option>
                                        <option value="2">Tue</option>
                                        <option value="3">Wed</option>
                                        <option value="4">Thu</option>
                                        <option value="5">Fri</option>
                                        <option value="6">Sat</option>
                                        <option value="0">Sun</option>
                                    </select>
                                    <label style="margin-left:8px;">Time:</label>
                                    <select id="scheduleHourWeekly"></select> : <select id="scheduleMinuteWeekly"></select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Schedule (Cron):</label>
                                <input type="text" id="workflowSchedule" placeholder="0 9 * * *" required>
                                <small>Use cron format: min hour day month weekday</small>
                            </div>
                            <div class="form-group">
                                <label>Account Name:</label>
                                <input type="text" id="workflowAccount" required>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="secondary-button cancel-btn">Cancel</button>
                                <button type="submit" class="primary-button">Create Workflow</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Integration Tab -->
            <div class="tab-content" id="integration-tab">
                <div class="section">
                    <div class="section-header">
                        <h2><i class="fas fa-puzzle-piece"></i> External Integrations</h2>
                        <p>Manage connections to external data sources</p>
                    </div>
                    
                    <div class="integration-status" id="integrationDetails">
                        <div class="loading">Loading integration details...</div>
                    </div>

                    <!-- People.ai Integration Spotlight -->
                    <div class="section" style="margin-top: 1.5rem;">
                        <div class="section-header">
                            <h2><i class="fas fa-handshake"></i> People.ai Integration (Preview)</h2>
                            <p>Preview how People.ai could enhance planning, insights, and execution</p>
                        </div>

                        <div class="partner-grid">
                            <div class="partner-card">
                                <div class="partner-header">
                                    <div class="partner-title">
                                        <span class="partner-badge">Potential Integration</span>
                                        <h3>People.ai Revenue Intelligence</h3>
                                        <p class="partner-sub">Contact auto-capture, activity intelligence, and coaching</p>
                                    </div>
                                    <div class="partner-actions">
                                        <button class="secondary-button" id="peopleaiLearnMore" onclick="window.open('https://www.people.ai','_blank')">
                                            <i class="fas fa-book-open"></i> Learn More
                                        </button>
                                        <button class="primary-button" id="openPeopleAIConfig">
                                            <i class="fas fa-plug"></i> Configure (Preview)
                                        </button>
                                    </div>
                                </div>
                                <div class="partner-body">
                                    <div class="partner-features">
                                        <div class="feature-item"><i class="fas fa-user-check"></i> Contact & Activity Auto-Capture</div>
                                        <div class="feature-item"><i class="fas fa-chart-line"></i> Engagement Scores in Account Health</div>
                                        <div class="feature-item"><i class="fas fa-lightbulb"></i> AI Coaching from Real Activity</div>
                                        <div class="feature-item"><i class="fas fa-diagram-project"></i> Opportunity Hygiene Signals</div>
                                        <div class="feature-item"><i class="fas fa-share-nodes"></i> Workflow Triggers from People.ai Signals</div>
                                    </div>
                                    <div class="partner-preview">
                                        <div class="preview-tile">
                                            <div class="tile-title">Engagement Intelligence</div>
                                            <div class="tile-meta">Sample</div>
                                            <div class="tile-content">C-suite coverage: 3/5 • Last 14d activity: High • Risky opps: 2</div>
                                        </div>
                                        <div class="preview-tile">
                                            <div class="tile-title">Coaching Insights</div>
                                            <div class="tile-meta">Sample</div>
                                            <div class="tile-content">“Influencer missing on Decision Team for Expansion EU — add VP Ops.”</div>
                                        </div>
                                        <div class="preview-tile">
                                            <div class="tile-title">Workflow Hooks</div>
                                            <div class="tile-meta">Sample</div>
                                            <div class="tile-content">Trigger weekly hygiene sweep → Slack summary + CRM tasks</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="dashboard-footer">
            <div class="footer-content">
                <p>&copy; 2025 AI Account Planner - Demo Technical Exercise</p>
                <div class="footer-links">
                    <span>Powered by BullMQ + Redis + Mixed AI Models</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Processing...</p>
        </div>
    </div>

    <!-- People.ai Config Modal (Preview) -->
    <div class="modal" id="peopleaiModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>People.ai Integration (Preview)</h3>
                <button class="close-modal" id="closePeopleAIConfig">&times;</button>
            </div>
            <div class="form-group">
                <label>Enable People.ai (Preview)</label>
                <input type="checkbox" id="peopleaiEnabled"> Enable visual widgets and workflow hooks
            </div>
            <div class="form-group">
                <label>Planned Capabilities</label>
                <div>
                    <label><input type="checkbox" id="peopleaiFeatureCapture"> Contact & Activity Auto-Capture</label>
                </div>
                <div>
                    <label><input type="checkbox" id="peopleaiFeatureEngagement"> Engagement Score → Health Model</label>
                </div>
                <div>
                    <label><input type="checkbox" id="peopleaiFeatureCoaching"> Coaching Insights → Daily Digest</label>
                </div>
                <div>
                    <label><input type="checkbox" id="peopleaiFeatureTriggers"> Workflow Triggers from People.ai Signals</label>
                </div>
            </div>
            <div class="form-actions">
                <button class="secondary-button" id="peopleaiDocs" onclick="window.open('https://www.people.ai','_blank')"><i class="fas fa-external-link-alt"></i> Docs</button>
                <button class="primary-button" id="savePeopleAIConfig"><i class="fas fa-save"></i> Save Preview</button>
            </div>
        </div>
    </div>

    <script src="/static/js/dashboard.js"></script>
</body>
</html>
